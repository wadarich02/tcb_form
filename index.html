<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAMU Capital Berhad - Digital Form</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="index_style.css">
    <style>
        /* Override datepicker styles to match your form */
        .ui-datepicker {
            font-size: 14px;
        }

        .ui-datepicker select.ui-datepicker-month,
        .ui-datepicker select.ui-datepicker-year {
            width: 45%;
        }

        /* Make date inputs consistent */
        input[type="date"] {
            height: 38px;
            padding: 6px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>TAMU Capital Berhad</h1>
            <p>Digital Application Form</p>
        </div>
        <div class="form-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- SECTION 1: CHECK-IN FORM -->
            <div class="form-section active" id="section1">
                <h2 class="section-title">SECTION 1: CHECK IN FORM</h2>
                <div class="subsection">
                    <h3>1.a Guest Information</h3>
                    <div class="form-grid">
                        <div class="form-group full-width"><label for="guestFullName">Full Name (As written in
                                IC/Passport)</label><input type="text" id="guestFullName" required></div>
                        <div class="form-group"><label for="guestIcPassport">IC/Passport Number</label><input
                                type="text" id="guestIcPassport" required></div>
                        <div class="form-group"><label for="guestDob">Date of Birth</label>
                            <input type="text" id="guestDob" required>
                        </div>
                        <div class="form-group"><label for="guestGender">Gender</label><select id="guestGender"
                                required>
                                <option value="" disabled selected>Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select></div>
                        <div class="form-group"><label for="guestNationality">Nationality</label><input type="text"
                                id="guestNationality" required></div>
                        <div class="form-group"><label>Marital Status</label>
                            <div class="checkbox-group"><label><input type="radio" name="maritalStatus" value="Married">
                                    Married</label><label><input type="radio" name="maritalStatus" value="Single">
                                    Single</label><label><input type="radio" name="maritalStatus" value="Others">
                                    Others</label></div>
                        </div>
                        <div class="form-group"><label for="guestNumChildren">Number of Children</label><input
                                type="number" id="guestNumChildren" min="0"></div>
                        <div class="form-group full-width"><label for="guestCorrespondentAddress">Correspondent
                                Address</label><textarea id="guestCorrespondentAddress" required></textarea></div>
                        <div class="form-group"><label for="guestPoskod">Poskod</label><input type="text"
                                id="guestPoskod" required></div>
                        <div class="form-group"><label for="guestCity">City/Country</label><input type="text"
                                id="guestCity" required></div>
                        <div class="form-group full-width"><label class="checkbox-group-title"><input type="checkbox"
                                    id="mailingSameAsCorrespondent"> Mailing address is the same as correspondent
                                address</label></div>
                        <div id="mailingAddressFields" class="form-grid full-width" style="display: none;">
                            <div class="form-group full-width"><label for="guestMailingAddress">Mailing
                                    Address</label><textarea id="guestMailingAddress"></textarea></div>
                            <div class="form-group"><label for="guestMailingPoskod">Mailing Poskod</label><input
                                    type="text" id="guestMailingPoskod"></div>
                            <div class="form-group"><label for="guestMailingCity">Mailing City/Country</label><input
                                    type="text" id="guestMailingCity"></div>
                        </div>
                        <div class="form-group"><label for="guestEmail">Email</label><input type="email" id="guestEmail"
                                required></div>
                        <div class="form-group"><label for="guestPhone">Phone Number</label><input type="tel"
                                id="guestPhone" required></div>
                    </div>
                </div>
                <div class="subsection">
                    <h3>1.b Guest's Business Information</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="guestOccupation">Occupation</label><input type="text"
                                id="guestOccupation" required></div>
                        <div class="form-group">
                            <label for="guestIndustry">Industry</label>
                            <select id="guestIndustry" required>
                                <option value="" disabled selected>Select Industry</option>
                                <option value="Agriculture">Agriculture</option>
                                <option value="Automotive">Automotive</option>
                                <option value="Banking">Banking</option>
                                <option value="Construction">Construction</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Education">Education</option>
                                <option value="Energy">Energy</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Finance">Finance</option>
                                <option value="Food & Beverage">Food & Beverage</option>
                                <option value="Government">Government</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Hospitality">Hospitality</option>
                                <option value="Information Technology">Information Technology</option>
                                <option value="Insurance">Insurance</option>
                                <option value="Legal">Legal</option>
                                <option value="Logistics">Logistics</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Media">Media</option>
                                <option value="Mining">Mining</option>
                                <option value="Non-Profit">Non-Profit</option>
                                <option value="Oil & Gas">Oil & Gas</option>
                                <option value="Pharmaceutical">Pharmaceutical</option>
                                <option value="Real Estate">Real Estate</option>
                                <option value="Retail">Retail</option>
                                <option value="Science">Science</option>
                                <option value="Telecommunications">Telecommunications</option>
                                <option value="Tourism">Tourism</option>
                                <option value="Transportation">Transportation</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group full-width"><label for="guestMonthlyIncome">Monthly Income</label><select
                                id="guestMonthlyIncome" required>
                                <option value="" disabled selected>Select Income Range</option>
                                <option value="4,000-6,000">4,000 - 6,000</option>
                                <option value="6,001-10,000">6,001 - 10,000</option>
                                <option value="10,001-15,000">10,001 - 15,000</option>
                                <option value="15,001-20,000">15,001 - 20,000</option>
                                <option value="20,001 and above">20,001 and above</option>
                            </select></div>
                    </div>
                </div>
                <div class="subsection">
                    <h3>2.a Guest's Partner Information</h3>
                    <div class="form-grid">
                        <div class="form-group full-width"><label for="partnerFullName">Full Name (As written in
                                IC/Passport)</label><input type="text" id="partnerFullName"></div>
                        <div class="form-group"><label for="partnerIcPassport">IC/Passport Number</label><input
                                type="text" id="partnerIcPassport"></div>
                        <div class="form-group"><label for="partnerDob">Date of Birth</label>
                            <input type="text" id="partnerDob">
                        </div>
                        <div class="form-group"><label for="partnerGender">Gender</label><select id="partnerGender">
                                <option value="" disabled selected>Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select></div>
                        <div class="form-group"><label for="partnerNationality">Nationality</label><input type="text"
                                id="partnerNationality"></div>
                        <div class="form-group"><label for="partnerPhone">Phone Number</label><input type="tel"
                                id="partnerPhone"></div>
                        <div class="form-group"><label for="relationshipToGuest">Relationship to guest</label><select
                                id="relationshipToGuest">
                                <option value="">Select Relationship</option>
                                <option value="Spouse">Spouse</option>
                                <option value="Parent">Parent</option>
                                <option value="Child">Child</option>
                                <option value="Sibling">Sibling</option>
                                <option value="Grandparent">Grandparent</option>
                                <option value="Relative">Relative</option>
                                <option value="Friend">Friend</option>
                                <option value="Legal Guardian">Legal Guardian</option>
                                <option value="Other">Other</option>
                            </select></div>
                    </div>
                </div>
                <div class="subsection">
                    <h3>2.b Partner's Business Information</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="partnerOccupation">Occupation</label><input type="text"
                                id="partnerOccupation"></div>
                        <div class="form-group">
                            <label for="partnerIndustry">Industry</label>
                            <select id="partnerIndustry">
                                <option value="" disabled selected>Select Industry</option>
                                <option value="Agriculture">Agriculture</option>
                                <option value="Automotive">Automotive</option>
                                <option value="Banking">Banking</option>
                                <option value="Construction">Construction</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Education">Education</option>
                                <option value="Energy">Energy</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Finance">Finance</option>
                                <option value="Food & Beverage">Food & Beverage</option>
                                <option value="Government">Government</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Hospitality">Hospitality</option>
                                <option value="Information Technology">Information Technology</option>
                                <option value="Insurance">Insurance</option>
                                <option value="Legal">Legal</option>
                                <option value="Logistics">Logistics</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Media">Media</option>
                                <option value="Mining">Mining</option>
                                <option value="Non-Profit">Non-Profit</option>
                                <option value="Oil & Gas">Oil & Gas</option>
                                <option value="Pharmaceutical">Pharmaceutical</option>
                                <option value="Real Estate">Real Estate</option>
                                <option value="Retail">Retail</option>
                                <option value="Science">Science</option>
                                <option value="Telecommunications">Telecommunications</option>
                                <option value="Tourism">Tourism</option>
                                <option value="Transportation">Transportation</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group full-width"><label for="partnerMonthlyIncome">Monthly
                                Income</label><select id="partnerMonthlyIncome">
                                <option value="" disabled selected>Select Income Range</option>
                                <option value="4,000-6,000">4,000 - 6,000</option>
                                <option value="6,001-10,000">6,001 - 10,000</option>
                                <option value="10,001-15,000">10,001 - 15,000</option>
                                <option value="15,001-20,000">15,001 - 20,000</option>
                                <option value="20,001 and above">20,001 and above</option>
                            </select></div>
                    </div>
                </div>

                <div class="subsection">
                    <h3>Guest Signature</h3>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <div class="signature-container">
                                <p>Please sign in the box below</p>
                                <canvas id="guestCheckInSignature" class="signature-canvas" height="150"></canvas>
                                <div class="signature-controls" style="text-align: right; margin-top: 5px;">
                                    <button type="button" class="btn btn-secondary"
                                        style="padding: 5px 15px; font-size: 0.8em; border-radius: 5px;"
                                        onclick="clearSignature('guestCheckInSignature')">Clear</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="guestCheckInSignatureName" readonly style="background: #e9ecef;">
                        </div>
                        <div class="form-group">
                            <label>IC</label>
                            <input type="text" id="guestCheckInSignatureIC" readonly style="background: #e9ecef;">
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="text" id="guestCheckInSignatureDate" data-default-today="true" readonly
                                style="background: #e9ecef;">
                        </div>
                    </div>
                </div>

                <div class="subsection">
                    <h3>FOR OFFICE USE ONLY</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="officeUseDay">Day</label>
                            <select id="officeUseDay">
                                <option value="" disabled selected>Select Day</option>
                                <option value="Sunday">Sunday</option>
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                                <option value="Saturday">Saturday</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="officeUseDate">Date</label>
                            <input type="text" id="officeUseDate" data-default-today="true">
                        </div>
                        <div class="form-group">
                            <label for="officeUseTimeIn">Time In</label>
                            <input type="time" id="officeUseTimeIn">
                        </div>
                        <div class="form-group">
                            <label for="officeUseTimeOut">Time Out</label>
                            <input type="time" id="officeUseTimeOut">
                        </div>
                        <div class="form-group">
                            <label for="officeUseTmCode">TM Code</label>
                            <input type="text" id="officeUseTmCode">
                        </div>
                        <div class="form-group">
                            <label for="officeUseConsultant">Consultant</label>
                            <input type="text" id="officeUseConsultant">
                        </div>
                        <div class="form-group full-width">
                            <label>Status</label>
                            <div class="checkbox-group">
                                <label><input type="radio" name="officeUseStatus" value="QT"> QT</label>
                                <label><input type="radio" name="officeUseStatus" value="NQ"> NQ</label>
                                <label><input type="radio" name="officeUseStatus" value="RESCHEDULED">
                                    RESCHEDULED</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-info" onclick="generateCheckInPdf()">Generate Check-In
                        PDF</button>
                    <button type="button" class="btn btn-success" onclick="exportPart1Data()">Export Part 1
                        JSON</button>
                    <div class="file-input-container">
                        <input type="file" id="importFile" accept=".json" onchange="importData()">
                        <label for="importFile" class="btn file-input-label">Import Data</label>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="nextSection()">Continue to Part 2</button>
                </div>
            </div>

            <!-- SECTION 2: CLOSING FORM -->
            <div class="form-section" id="section2">
                <h2 class="section-title">PART 2: CLOSING</h2>
                <div class="subsection">
                    <h3>3. Membership Applicant</h3>
                    <div class="form-grid">
                        <div class="form-group"><label>Applicant is</label>
                            <div class="checkbox-group"><label><input type="radio" name="applicantType" value="Guest's"
                                        checked>
                                    Guest</label><label><input type="radio" name="applicantType"
                                        value="Guest's Partner"> Guest's
                                    Partner</label></div>
                        </div>
                        <div class="form-group"><label for="applicantNameOnCard">Name on Card</label>
                            <div style="display: flex; gap: 10px;"><select id="applicantTitle" style="width: 100px;">
                                    <option value="Mr">Mr</option>
                                    <option value="Mrs">Mrs</option>
                                    <option value="Ms">Ms</option>
                                    <option value="Mdm">Mdm</option>
                                </select><input type="text" id="applicantNameOnCard" style="flex-grow: 1;"></div>
                        </div>
                    </div>
                </div>
                <div class="subsection">
                    <h3>3.b Applicant Office Address</h3>
                    <div class="form-grid">
                        <div class="form-group full-width"><label for="applicantOfficeAddress">Office
                                Address</label><textarea id="applicantOfficeAddress"></textarea></div>
                        <div class="form-group"><label for="applicantOfficePoskod">Poskod</label><input type="text"
                                id="applicantOfficePoskod"></div>
                        <div class="form-group"><label for="applicantOfficeCity">City/Country</label><input type="text"
                                id="applicantOfficeCity"></div>
                        <div class="form-group"><label for="applicantOfficeTel">Office Tel Number</label><input
                                type="tel" id="applicantOfficeTel"></div>
                        <div class="form-group"><label for="applicantFax">Fax</label><input type="text"
                                id="applicantFax"></div>
                    </div>
                </div>
                <div class="subsection">
                    <h3>3.c Applicant Banking Details</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="applicantBankName">Bank Name</label><input type="text"
                                id="applicantBankName"></div>
                        <div class="form-group"><label for="applicantAccountNumber">Account Number</label><input
                                type="text" id="applicantAccountNumber"></div>
                    </div>
                </div>
                <div class="subsection">
                    <h3>3.d Source of Funds</h3>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="sourceOfFunds" value="Cash Savings"> Cash Savings</label>
                        <label><input type="checkbox" name="sourceOfFunds" value="Credit Card"> Credit Card</label>
                        <label><input type="checkbox" name="sourceOfFunds" value="Inheritance"> Inheritance</label>
                        <label><input type="checkbox" name="sourceOfFunds" value="Others"> Others</label>
                    </div>
                </div>
                <div class="subsection">
                    <h3>4. Nominee</h3>
                    <div class="form-group full-width"><label class="checkbox-group-title"><input type="checkbox"
                                id="nomineeIsPartner" checked> Nominee is the same as Guest's Partner (filled in Part
                            1)</label>
                    </div>

                    <div id="nomineeDetailsSection" style="display:none;">
                        <p class="btn-warning"
                            style="padding: 10px; border-radius: 5px; text-align: center; color: #333; margin-bottom: 15px;">
                            Please
                            fill in the details for the nominee below.</p>
                        <div class="subsection">
                            <h3>4.a Nominee Information</h3>
                            <div class="form-grid">
                                <div class="form-group full-width"><label for="nomineeFullName">Full Name</label><input
                                        type="text" id="nomineeFullName" required></div>
                                <div class="form-group"><label for="nomineeIcPassport">IC/Passport</label><input
                                        type="text" id="nomineeIcPassport" required></div>
                                <div class="form-group"><label for="nomineeDob">Date of Birth</label><input type="date"
                                        id="nomineeDob" required></div>
                                <div class="form-group"><label for="nomineeRelationship">Relationship</label><input
                                        type="text" id="nomineeRelationship" required></div>
                            </div>
                        </div>
                        <div class="subsection">
                            <h3>4.b Nominee Business Information</h3>
                            <div class="form-grid">
                                <div class="form-group"><label for="nomineeOccupation">Occupation</label><input
                                        type="text" id="nomineeOccupation"></div>
                                <div class="form-group"><label for="nomineeIndustry">Industry</label><input type="text"
                                        id="nomineeIndustry"></div>
                            </div>
                        </div>
                        <div class="subsection">
                            <h3>4.c Nominee Banking Details</h3>
                            <div class="form-grid">
                                <div class="form-group"><label for="nomineeBankName">Bank Name</label><input type="text"
                                        id="nomineeBankName"></div>
                                <div class="form-group"><label for="nomineeAccountNumber">Account Number</label><input
                                        type="text" id="nomineeAccountNumber"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="subsection">
                    <h3>5. Third Party Payor</h3>
                    <div class="form-group full-width"><label class="checkbox-group-title"><input type="checkbox"
                                id="payorIsApplicant" checked> Payor is the Applicant</label></div>

                    <div id="thirdPartyPayorSection" style="display:none;">
                        <p class="btn-warning"
                            style="padding: 10px; border-radius: 5px; text-align: center; color: #333; margin-bottom: 15px;">
                            Please
                            fill in the details for the Third Party Payor below.</p>
                        <div class="subsection">
                            <h3>Payor Personal Information</h3>
                            <div class="form-grid">
                                <div class="form-group full-width"><label for="payorFullName">Full Name</label><input
                                        type="text" id="payorFullName" required></div>
                                <div class="form-group"><label for="payorIcPassport">IC/Passport</label><input
                                        type="text" id="payorIcPassport" required></div>
                                <div class="form-group"><label for="payorDob">Date of Birth</label><input type="date"
                                        id="payorDob" required>
                                </div>
                            </div>
                        </div>
                        <div class="subsection">
                            <h3>Payor Business Information</h3>
                            <div class="form-grid">
                                <div class="form-group"><label for="payorOccupation">Occupation</label><input
                                        type="text" id="payorOccupation"></div>
                                <div class="form-group"><label for="payorIndustry">Industry</label><input type="text"
                                        id="payorIndustry"></div>
                                <div class="form-group full-width"><label for="payorOfficeAddress">Payor's Office
                                        Address</label><textarea id="payorOfficeAddress"></textarea></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="subsection">
                    <h3>Sales Detail (To be filled out by consultant)</h3>
                    <div class="form-grid">
                        <div class="form-group"><label class="checkbox-group-title">Product</label>
                            <div class="checkbox-group"><label><input type="checkbox" name="productType"
                                        value="Dirham">Dirham</label><label><input type="checkbox" name="productType"
                                        value="Dinar">Dinar</label><label><input type="checkbox" name="productType"
                                        value="Almas">Almas</label></div>
                        </div>
                        <div class="form-group"><label for="worksheetCode">Worksheet Code</label><input type="text"
                                id="worksheetCode"></div>
                        <div class="form-group"><label for="subscriptionAmount">Subscription Amount (RM)</label><input
                                type="number" id="subscriptionAmount" value="0"></div>
                        <div class="form-group"><label for="investmentAmount">Investment Amount (RM)</label><input
                                type="number" id="investmentAmount" value="0"></div>
                        <div class="form-group"><label for="totalAmount">Total Amount (RM)</label><input type="number"
                                id="totalAmount" readonly style="background-color: #e9ecef;"></div>
                        <div class="form-group"><label>Profit Receiver</label>
                            <div class="checkbox-group"><label><input type="radio" name="profitReceiver"
                                        value="Applicant" checked>Applicant</label><label><input type="radio"
                                        name="profitReceiver" value="Nominee">Nominee</label></div>
                        </div>
                        <div class="form-group full-width"><label class="checkbox-group-title">Method of
                                Transaction</label>
                            <div class="checkbox-group"><label><input type="radio" name="transactionMethod"
                                        value="Debit/Credit/Cash/Cheque" checked>
                                    Debit/Credit/Cash/Cheque</label><label><input type="radio" name="transactionMethod"
                                        value="Others"> Others</label></div>
                        </div>
                        <div class="form-group"><label for="orNumber">OR Number</label><input type="text" id="orNumber">
                        </div>
                        <div class="form-group"><label for="aprCode">APR Code</label><input type="text" id="aprCode">
                        </div>
                        <div class="form-group"><label for="consultantName">Consultant's Name</label><input type="text"
                                id="consultantName"></div>
                        <div class="form-group"><label for="consultantCode">Consultant's Code</label><input type="text"
                                id="consultantCode"></div>
                    </div>
                </div>
                <div class="button-group"><button type="button" class="btn btn-secondary"
                        onclick="previousSection()">Back</button><button type="button" class="btn btn-primary"
                        onclick="nextSection()">Continue</button></div>
            </div>

            <!-- SECTION 3: DECLARATIONS & CONSENT -->
            <div class="form-section" id="section3">
                <h2 class="section-title">Declarations & Consent</h2>
                <p style="margin-bottom: 25px; font-size: 1.1em;">Please read the following sections carefully. By
                    ticking each box, you acknowledge that you have read, understood, and agreed to the respective
                    terms.</p>
                <div class="consent-checkbox"><input type="checkbox" id="rulesRegulationsConsent" required><span>I have
                        read, understood, and agree to the <button type="button" class="btn btn-warning"
                            onclick="showModal('rulesModal')">Rules & Regulations</button>.</span></div>
                <div class="consent-checkbox"><input type="checkbox" id="subscriptionTermsConsent" required><span>I have
                        read, understood, and agree to the <button type="button" class="btn btn-warning"
                            onclick="showModal('subscriptionModal')">Subscription Terms & Conditions</button>.</span>
                </div>
                <div class="consent-checkbox"><input type="checkbox" id="investmentTermsConsent" required><span>I have
                        read, understood, and agree to the <button type="button" class="btn btn-warning"
                            onclick="showModal('investmentModal')">Investment (Wakalah) Terms &
                            Conditions</button>.</span></div>
                <hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">

                <h3 style="margin-bottom: 15px;">By continuing, you confirm the following:</h3>
                <div class="consent-checkbox" style="background: #e8f5e9; border-color: #a5d6a7;">
                    <input type="checkbox" id="finalConsent1" required>
                    <span>I have read and understood the Rules & Regulations, Subscription Terms & Conditions, and
                        Investment
                        (Wakalah) Terms & Conditions provided by TAMU Capital Berhad.</span>
                </div>
                <div class="consent-checkbox" style="background: #e8f5e9; border-color: #a5d6a7;">
                    <input type="checkbox" id="finalConsent2" required>
                    <span>I agree and give my consent to be bound by all the above terms, and confirm that the
                        information I have
                        provided is accurate and compliant with all applicable legal and regulatory requirements.</span>
                </div>

                <div class="button-group"><button type="button" class="btn btn-secondary"
                        onclick="previousSection()">Back</button><button type="button" class="btn btn-primary"
                        onclick="nextSection()">Continue</button></div>
            </div>

            <!-- SECTION 4: SIGNATURE PAGE -->
            <div class="form-section" id="section4">
                <div class="button-group" style="justify-content: flex-start; margin-top: 0; margin-bottom: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="showSection(1)">Back to Check-In</button>
                </div>
                <h2 class="section-title">SIGNATURE PAGE</h2>
                <div class="form-grid">
                    <div class="subsection">
                        <h3>Applicant</h3>
                        <div class="signature-container">
                            <p>Please sign in the box below</p><canvas id="applicantSignature" class="signature-canvas"
                                height="150"></canvas>
                            <div class="signature-controls" style="text-align: right;"><button type="button"
                                    class="btn btn-secondary" style="padding: 5px 15px; font-size: 0.8em;"
                                    onclick="clearSignature('applicantSignature')">Clear</button></div>
                        </div>
                        <div class="form-group" style="margin-top:15px;"><label
                                for="applicantSignatureName">Name</label><input type="text" id="applicantSignatureName"
                                required></div>
                        <div class="form-group"><label for="applicantSignatureIC">IC</label><input type="text"
                                id="applicantSignatureIC" required></div>
                        <div class="form-group">
                            <label for="applicantSignatureDate">Date</label>
                            <input type="text" id="applicantSignatureDate" data-default-today="true" required>
                        </div>
                    </div>
                    <div class="subsection">
                        <h3>Nominee</h3>
                        <div class="signature-container">
                            <p>Please sign in the box below</p><canvas id="nomineeSignature" class="signature-canvas"
                                height="150"></canvas>
                            <div class="signature-controls" style="text-align: right;"><button type="button"
                                    class="btn btn-secondary" style="padding: 5px 15px; font-size: 0.8em;"
                                    onclick="clearSignature('nomineeSignature')">Clear</button></div>
                        </div>
                        <div class="form-group" style="margin-top:15px;"><label
                                for="nomineeSignatureName">Name</label><input type="text" id="nomineeSignatureName">
                        </div>
                        <div class="form-group"><label for="nomineeSignatureIC">IC</label><input type="text"
                                id="nomineeSignatureIC"></div>
                        <div class="form-group"><label for="nomineeSignatureDate">Date</label><input type="text"
                                id="nomineeSignatureDate" data-default-today="true"></div>
                    </div>
                    <div class="subsection">
                        <h3>3rd Party Payor</h3>
                        <div class="signature-container">
                            <p>Please sign in the box below</p><canvas id="thirdPartyPayorSignature"
                                class="signature-canvas" height="150"></canvas>
                            <div class="signature-controls" style="text-align: right;"><button type="button"
                                    class="btn btn-secondary" style="padding: 5px 15px; font-size: 0.8em;"
                                    onclick="clearSignature('thirdPartyPayorSignature')">Clear</button></div>
                        </div>
                        <div class="form-group" style="margin-top:15px;"><label
                                for="thirdPartyPayorSignatureName">Name</label><input type="text"
                                id="thirdPartyPayorSignatureName">
                        </div>
                        <div class="form-group"><label for="thirdPartyPayorSignatureIC">IC</label><input type="text"
                                id="thirdPartyPayorSignatureIC"></div>
                        <div class="form-group"><label for="thirdPartyPayorSignatureDate">Date</label><input type="text"
                                id="thirdPartyPayorSignatureDate" data-default-today="true"></div>
                    </div>
                    <div class="subsection">
                        <h3>Consultant</h3>
                        <div class="signature-container">
                            <p>Please sign in the box below</p><canvas id="consultantSignature" class="signature-canvas"
                                height="150"></canvas>
                            <div class="signature-controls" style="text-align: right;"><button type="button"
                                    class="btn btn-secondary" style="padding: 5px 15px; font-size: 0.8em;"
                                    onclick="clearSignature('consultantSignature')">Clear</button></div>
                        </div>
                        <div class="form-group" style="margin-top:15px;"><label
                                for="consultantSignatureName">Name</label><input type="text"
                                id="consultantSignatureName"></div>
                        <div class="form-group"><label for="consultantSignatureIC">IC</label><input type="text"
                                id="consultantSignatureIC"></div>
                        <div class="form-group"><label for="consultantSignatureDate">Date</label><input type="text"
                                id="consultantSignatureDate" data-default-today="true"></div>
                    </div>
                    <div class="subsection">
                        <h3>Witness/Sale Admin</h3>
                        <div class="signature-container">
                            <p>Please sign in the box below</p><canvas id="witnessSignature" class="signature-canvas"
                                height="150"></canvas>
                            <div class="signature-controls" style="text-align: right;"><button type="button"
                                    class="btn btn-secondary" style="padding: 5px 15px; font-size: 0.8em;"
                                    onclick="clearSignature('witnessSignature')">Clear</button></div>
                        </div>
                        <div class="form-group" style="margin-top:15px;"><label
                                for="witnessSignatureName">Name</label><input type="text" id="witnessSignatureName">
                        </div>
                        <div class="form-group"><label for="witnessSignatureIC">IC</label><input type="text"
                                id="witnessSignatureIC"></div>
                        <div class="form-group"><label for="witnessSignatureDate">Date</label><input type="text"
                                id="witnessSignatureDate" data-default-today="true"></div>
                    </div>
                    <div class="subsection">
                        <h3>Investment Manager</h3>
                        <div class="signature-container">
                            <p>Please sign in the box below</p><canvas id="investmentManagerSignature"
                                class="signature-canvas" height="150"></canvas>
                            <div class="signature-controls" style="text-align: right;"><button type="button"
                                    class="btn btn-secondary" style="padding: 5px 15px; font-size: 0.8em;"
                                    onclick="clearSignature('investmentManagerSignature')">Clear</button></div>
                        </div>
                        <div class="form-group" style="margin-top:15px;"><label
                                for="investmentManagerSignatureName">Name</label><input type="text"
                                id="investmentManagerSignatureName">
                        </div>
                        <div class="form-group"><label for="investmentManagerSignatureIC">IC</label><input type="text"
                                id="investmentManagerSignatureIC"></div>
                        <div class="form-group"><label for="investmentManagerSignatureDate">Date</label><input
                                type="text" id="investmentManagerSignatureDate" data-default-today="true"></div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="previousSection()">Back to
                        Declarations</button>
                    <button type="button" class="btn btn-primary" onclick="exportFullData()">Export Full JSON</button>
                    <button type="button" class="btn btn-success" onclick="generateCombinedPdf()">Compile & Download
                        Forms</button>
                </div>
            </div>
        </div>
    </div>

    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Rules & Regulations</h2><span class="close" onclick="closeModal('rulesModal')">×</span>
            </div>
            <div class="modal-body">
                <p>As a prospective participant in any TAMU Capital Berhad program, you are required to acknowledge and
                    adhere to the following rules and general regulations:</p>
                <ol>
                    <li>All personal, financial, and contact information provided must be accurate, complete, and
                        updated promptly in the event of any changes.</li>
                    <li>Subscribers must be individuals aged 18 and above, of sound mind, and not acting on behalf of
                        any third party unless explicitly declared.</li>
                    <li>Participation is subject to the laws of Malaysia, including compliance with the Anti-Money
                        Laundering, Anti-Terrorism Financing and Proceeds of Unlawful Activities Act 2001 (AMLA).</li>
                    <li>Third-party contributions or payments must be accompanied by full disclosure, including the
                        payer's name, NRIC/passport number, and relationship to the subscriber.</li>
                    <li>All required supporting documents, including but not limited to copies of NRIC, proof of
                        payment, and verification forms, must be submitted when requested.</li>
                    <li>TAMU Capital Berhad reserves the right to reject or terminate any application or participation
                        found to be in violation of these regulations or containing false declarations.</li>
                    <li>Subscriber data will be treated as confidential and handled in accordance with applicable data
                        protection laws, and will only be used for internal verification and regulatory purposes.</li>
                </ol>
            </div>
        </div>
    </div>
    <div id="subscriptionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Subscription Terms & Conditions</h2><span class="close"
                    onclick="closeModal('subscriptionModal')">×</span>
            </div>
            <div class="modal-body">
                <p>By submitting this application, you confirm that you have read and understood the terms governing the
                    subscription to TAMU Capital Berhad's programs (Dirham, Dinar, or Almas), and you hereby agree to
                    the following:</p>
                <ol>
                    <li>Program selection and participation are based on the available packages and are subject to TAMU
                        Capital's discretion and compliance checks.</li>
                    <li>Payments can be made via cash, in-house instalments, or approved financing options, as per the
                        chosen package and agreed schedule.</li>
                    <li>Subscription fees are final and non-refundable unless stated otherwise under specific
                        circumstances.</li>
                    <li>Profit distributions, if applicable, are made annually and are based on actual fund performance.
                        The maximum indicative return is up to 5% per annum.</li>
                    <li>Early withdrawals or terminations may result in the forfeiture of profit entitlements and may be
                        subject to specific terms outlined in the final agreement.</li>
                    <li>TAMU Capital reserves the right to issue all communications, including program updates and
                        notices, through the contact details provided by the subscriber.</li>
                </ol>
            </div>
        </div>
    </div>
    <div id="investmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>WAKALAH (INVESTMENT) TERMS & CONDITIONS</h2><span class="close"
                    onclick="closeModal('investmentModal')">×</span>
            </div>
            <div class="modal-body">
                <p>TAMU Capital Berhad operates under a Shariah-compliant investment structure known as Wakalah Bi
                    Al-Istithmar. By participating in this investment scheme, you acknowledge and accept the following:
                </p>
                <ol>
                    <li>TAMU Capital Berhad will act as the Wakeel (agent) to manage your invested funds in accordance
                        with Shariah principles and ethical investment practices.</li>
                    <li>Investment capital is not guaranteed. Any potential profit is based solely on fund performance,
                        and there is a possibility of capital loss.</li>
                    <li>The indicative return is up to 5% per annum, distributed annually over a five-year term.
                        However, actual returns are not fixed or assured.</li>
                    <li>Annual investment statements and performance updates will be made available to subscribers upon
                        request, subject to internal policies.</li>
                    <li>Subscribers are required to declare that all invested funds are sourced from legitimate means
                        and not connected to any unlawful or suspicious activity.</li>
                    <li>TAMU Capital reserves the right to report suspicious transactions or non-compliance to the
                        relevant authorities in accordance with AMLA 2001.</li>
                    <li>In the event of disputes or ambiguities, resolution will be pursued through amicable means or,
                        where applicable, a Shariah-compliant arbitration process.</li>
                </ol>
            </div>
        </div>
    </div>
    <script>
        let currentSection = 1;
        const totalSections = 4;
        let signatures = {};
        let signaturePadsInitialized = { section1: false, section4: false };

        function showSection(sectionNumber) {
            document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
            document.getElementById(`section${sectionNumber}`).classList.add('active');
            currentSection = sectionNumber;
            updateProgress();
            window.scrollTo(0, 0);
            if (currentSection === 1 && !signaturePadsInitialized.section1) {
                initializeSignatureCanvas('guestCheckInSignature');
                signaturePadsInitialized.section1 = true;
            }
            if (currentSection === 4 && !signaturePadsInitialized.section4) {
                initializeAllSignaturePads();
                signaturePadsInitialized.section4 = true;
            }
        }

        // Add this function to handle date formatting
        function formatDateInput(input) {
            if (!input) return '';
            return moment(input).format('DD/MM/YYYY');
        }

        function nextSection() {
            if (validateCurrentSection()) {
                currentSection < totalSections &&
                    showSection(currentSection + 1);
            }
        } function previousSection() {
            if (currentSection > 1) {
                showSection(currentSection - 1);
            }
        }
        function updateProgress() {
            const progress = ((currentSection - 1) / (totalSections - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function validateCurrentSection() {
            const section = document.getElementById(`section${currentSection}`);
            const requiredFields = section.querySelectorAll('[required]');
            let isValid = true;
            for (let field of requiredFields) {
                if (field.closest('#nomineeDetailsSection')?.style.display === 'none' ||
                    field.closest('#thirdPartyPayorSection')?.style.display === 'none') {
                    continue;
                }
                if (field.type === 'radio' && field.name) {
                    const radioGroup = document.getElementsByName(field.name);
                    if (![...radioGroup].some(r => r.checked)) {
                        alert(`Please make a selection for: ${field.closest('.form-group,.checkbox-group').parentElement.querySelector('label, .checkbox-group-title').textContent}`);
                        field.focus();
                        isValid = false;
                        break;
                    }
                } else if (field.type === 'checkbox' && !field.checked) {
                    alert('Please agree to the required terms.');
                    field.focus();
                    isValid = false;
                    break;
                } else if (field.tagName === 'CANVAS' && !signatures[field.id]) {
                    alert(`Signature is required for: ${field.closest('.subsection').querySelector('h3').textContent}`);
                    isValid = false;
                    break;
                } else if (field.tagName !== 'CANVAS' && !field.value.trim()) {
                    alert(`Please fill in the required field: ${field.closest('.form-group')?.querySelector('label')?.textContent || field.id}`);
                    field.focus();
                    isValid = false;
                    break;
                }
            }
            if (!isValid) return false;

            if (currentSection === 4 && !signatures['applicantSignature']) {
                alert('Applicant signature is required.');
                return false;
            }
            return true;
        }

        function showModal(modalId) { document.getElementById(modalId).style.display = "block"; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = "none"; }
        window.onclick = function (event) {
            document.querySelectorAll('.modal').forEach(modal => {
                if (event.target ==
                    modal) { modal.style.display = "none"; }
            });
        }

        function initializeAllSignaturePads() {
            ['applicantSignature', 'nomineeSignature', 'thirdPartyPayorSignature',
                'consultantSignature', 'witnessSignature', 'investmentManagerSignature'].forEach(initializeSignatureCanvas);
        }
        function initializeSignatureCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let drawing = false;
            function resizeCanvas() { canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight; }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect(); const clientX = e.touches ?
                    e.touches[0].clientX : e.clientX; const clientY = e.touches ? e.touches[0].clientY : e.clientY; return {
                        x:
                            clientX - rect.left, y: clientY - rect.top
                    };
            };
            const startDrawing = (e) => {
                e.preventDefault(); drawing = true; const pos = getPos(e); ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            };
            const draw = (e) => {
                if (!drawing) return; e.preventDefault(); const pos = getPos(e); ctx.lineWidth = 2.5;
                ctx.lineCap = 'round'; ctx.strokeStyle = '#2c3e50'; ctx.lineTo(pos.x, pos.y); ctx.stroke(); ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            };
            const stopDrawing = () => {
                if (!drawing) return; drawing = false; signatures[canvasId] =
                    canvas.toDataURL('image/png');
            };
            canvas.addEventListener('mousedown', startDrawing); canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing); canvas.addEventListener('mouseout', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing, { passive: false }); canvas.addEventListener('touchmove',
                draw, { passive: false }); canvas.addEventListener('touchend', stopDrawing);
        }
        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId); const ctx =
                canvas.getContext('2d'); ctx.clearRect(0, 0, canvas.width, canvas.height); delete signatures[canvasId];
        }

        function collectData() {
            const getCheckedValues = (name) => Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(el => el.value);

            // Helper function to get formatted date value
            const getDateValue = (elementId) => {
                const el = document.getElementById(elementId);
                if (!el) return '';
                // Get the stored date value in YYYY-MM-DD format
                const dateValue = $(el).attr('data-date');
                return dateValue ? moment(dateValue).format('DD/MM/YYYY') : '';
            };

            return {
                part1: {
                    guestInfo: {
                        fullName: document.getElementById('guestFullName').value,
                        icPassport: document.getElementById('guestIcPassport').value,
                        dob: getDateValue('guestDob'),
                        gender: document.getElementById('guestGender').value,
                        nationality: document.getElementById('guestNationality').value,
                        maritalStatus: getCheckedValues('maritalStatus')[0] || '',
                        numChildren: document.getElementById('guestNumChildren').value,
                        correspondentAddress: document.getElementById('guestCorrespondentAddress').value,
                        poskod: document.getElementById('guestPoskod').value,
                        city: document.getElementById('guestCity').value,
                        mailingSameAsCorrespondent: document.getElementById('mailingSameAsCorrespondent').checked,
                        mailingAddress: document.getElementById('guestMailingAddress').value,
                        mailingPoskod: document.getElementById('guestMailingPoskod').value,
                        mailingCity: document.getElementById('guestMailingCity').value,
                        email: document.getElementById('guestEmail').value,
                        phone: document.getElementById('guestPhone').value
                    },
                    guestBusiness: {
                        occupation: document.getElementById('guestOccupation').value,
                        industry: document.getElementById('guestIndustry').value,
                        monthlyIncome: document.getElementById('guestMonthlyIncome').value
                    },
                    partnerInfo: {
                        fullName: document.getElementById('partnerFullName').value,
                        icPassport: document.getElementById('partnerIcPassport').value,
                        dob: getDateValue('partnerDob'),
                        gender: document.getElementById('partnerGender').value,
                        nationality: document.getElementById('partnerNationality').value,
                        phone: document.getElementById('partnerPhone').value,
                        relationshipToGuest: document.getElementById('relationshipToGuest').value
                    },
                    partnerBusiness: {
                        occupation: document.getElementById('partnerOccupation').value,
                        industry: document.getElementById('partnerIndustry').value,
                        monthlyIncome: document.getElementById('partnerMonthlyIncome').value
                    },
                    guestCheckInSignature: {
                        signatureData: signatures.guestCheckInSignature,
                        name: document.getElementById('guestCheckInSignatureName').value,
                        ic: document.getElementById('guestCheckInSignatureIC').value,
                        date: getDateValue('guestCheckInSignatureDate')
                    },
                    officeUse: {
                        day: document.getElementById('officeUseDay').value,
                        date: getDateValue('officeUseDate'),
                        timeIn: document.getElementById('officeUseTimeIn').value,
                        timeOut: document.getElementById('officeUseTimeOut').value,
                        tmCode: document.getElementById('officeUseTmCode').value,
                        consultant: document.getElementById('officeUseConsultant').value,
                        status: getCheckedValues('officeUseStatus')[0] || ''
                    }
                },
                part2: {
                    membershipApplicant: {
                        applicantType: getCheckedValues('applicantType')[0] || '',
                        title: document.getElementById('applicantTitle').value,
                        nameOnCard: document.getElementById('applicantNameOnCard').value
                    },
                    applicantOffice: {
                        address: document.getElementById('applicantOfficeAddress').value,
                        poskod: document.getElementById('applicantOfficePoskod').value,
                        city: document.getElementById('applicantOfficeCity').value,
                        tel: document.getElementById('applicantOfficeTel').value,
                        fax: document.getElementById('applicantFax').value
                    },
                    applicantBanking: {
                        bankName: document.getElementById('applicantBankName').value,
                        accountNumber: document.getElementById('applicantAccountNumber').value
                    },
                    sourceOfFunds: getCheckedValues('sourceOfFunds'),
                    nominee: {
                        isPartner: document.getElementById('nomineeIsPartner').checked,
                        fullName: document.getElementById('nomineeFullName').value,
                        icPassport: document.getElementById('nomineeIcPassport').value,
                        dob: getDateValue('nomineeDob'),
                        relationship: document.getElementById('nomineeRelationship').value,
                        occupation: document.getElementById('nomineeOccupation').value,
                        industry: document.getElementById('nomineeIndustry').value,
                        bankName: document.getElementById('nomineeBankName').value,
                        accountNumber: document.getElementById('nomineeAccountNumber').value
                    },
                    thirdPartyPayor: {
                        isApplicant: document.getElementById('payorIsApplicant').checked,
                        fullName: document.getElementById('payorFullName').value,
                        icPassport: document.getElementById('payorIcPassport').value,
                        dob: getDateValue('payorDob'),
                        occupation: document.getElementById('payorOccupation').value,
                        industry: document.getElementById('payorIndustry').value,
                        officeAddress: document.getElementById('payorOfficeAddress').value
                    },
                    salesDetail: {
                        productTypes: getCheckedValues('productType'),
                        worksheetCode: document.getElementById('worksheetCode').value,
                        subscriptionAmount: document.getElementById('subscriptionAmount').value,
                        investmentAmount: document.getElementById('investmentAmount').value,
                        totalAmount: document.getElementById('totalAmount').value,
                        profitReceiver: getCheckedValues('profitReceiver')[0] || '',
                        transactionMethod: getCheckedValues('transactionMethod')[0] || '',
                        orNumber: document.getElementById('orNumber').value,
                        aprCode: document.getElementById('aprCode').value,
                        consultantName: document.getElementById('consultantName').value,
                        consultantCode: document.getElementById('consultantCode').value
                    }
                },
                signatures: {
                    applicant: {
                        signatureData: signatures.applicantSignature,
                        name: document.getElementById('applicantSignatureName').value,
                        ic: document.getElementById('applicantSignatureIC').value,
                        date: getDateValue('applicantSignatureDate')
                    },
                    nominee: {
                        signatureData: signatures.nomineeSignature,
                        name: document.getElementById('nomineeSignatureName').value,
                        ic: document.getElementById('nomineeSignatureIC').value,
                        date: getDateValue('nomineeSignatureDate')
                    },
                    thirdPartyPayor: {
                        signatureData: signatures.thirdPartyPayorSignature,
                        name: document.getElementById('thirdPartyPayorSignatureName').value,
                        ic: document.getElementById('thirdPartyPayorSignatureIC').value,
                        date: getDateValue('thirdPartyPayorSignatureDate')
                    },
                    consultant: {
                        signatureData: signatures.consultantSignature,
                        name: document.getElementById('consultantSignatureName').value,
                        ic: document.getElementById('consultantSignatureIC').value,
                        date: getDateValue('consultantSignatureDate')
                    },
                    witness: {
                        signatureData: signatures.witnessSignature,
                        name: document.getElementById('witnessSignatureName').value,
                        ic: document.getElementById('witnessSignatureIC').value,
                        date: getDateValue('witnessSignatureDate')
                    },
                    investmentManager: {
                        signatureData: signatures.investmentManagerSignature,
                        name: document.getElementById('investmentManagerSignatureName').value,
                        ic: document.getElementById('investmentManagerSignatureIC').value,
                        date: getDateValue('investmentManagerSignatureDate')
                    }
                }
            };
        }

        function generateCheckInPdf() {
            if (!validateCurrentSection()) return;
            const formData = collectData();
            localStorage.setItem('tamuPrintData', JSON.stringify(formData));
            window.open('1_check_in.html', '_blank');
        }

        function exportPart1Data() {
            if (!validateCurrentSection()) { return; }
            const fullData = collectData();
            const guestName = fullData.part1.guestInfo.fullName.trim().replace(/\s+/g, '_') || 'Guest';
            const fileName = `${guestName}_CheckIn_Data.json`;
            const dataStr = JSON.stringify({ part1: fullData.part1 }, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert(`Part 1 (Check-In) data exported successfully as ${fileName}`);
        }

        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) { alert('Please select a file to import.'); return; }
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    populateForm(data);
                    alert('Data imported successfully!');
                } catch (error) {
                    alert('Error importing data. Please check the file format.');
                    console.error('Import Error:', error);
                }
            };
            reader.readAsText(file);
        }

        function populateForm(data) {
            const setVal = (id, value) => {
                const el = document.getElementById(id); if (el && value !== undefined && value
                    !== null) el.value = value;
            };
            const setCheck = (id, value) => {
                const el = document.getElementById(id); if (el && value !== undefined && value
                    !== null) el.checked = value;
            };
            const setRadio = (name, value) => {
                if (value) {
                    const el = document.querySelector(`input[name="${name}"][value="${value}"]`);
                    if (el) el.checked = true;
                }
            };
            const setMultiCheck = (name, values) => {
                if (values && Array.isArray(values)) {
                    document.querySelectorAll(`input[name="${name}"]`).forEach(cb => cb.checked = values.includes(cb.value));
                }
            };

            if (data.part1) {
                if (data.part1.guestInfo) {
                    Object.keys(data.part1.guestInfo).forEach(key =>
                        setVal(`guest${key.charAt(0).toUpperCase() + key.slice(1)}`, data.part1.guestInfo[key]));
                    setRadio('maritalStatus', data.part1.guestInfo.maritalStatus);
                    setCheck('mailingSameAsCorrespondent', data.part1.guestInfo.mailingSameAsCorrespondent);
                    document.getElementById('mailingSameAsCorrespondent').dispatchEvent(new Event('change'));
                }
                if (data.part1.guestBusiness) {
                    Object.keys(data.part1.guestBusiness).forEach(key =>
                        setVal(`guest${key.charAt(0).toUpperCase() + key.slice(1)}`, data.part1.guestBusiness[key]));
                }
                if (data.part1.partnerInfo) {
                    Object.keys(data.part1.partnerInfo).forEach(key =>
                        setVal(`partner${key.charAt(0).toUpperCase() + key.slice(1)}`, data.part1.partnerInfo[key]));
                    setVal('relationshipToGuest', data.part1.partnerInfo.relationshipToGuest);
                }
                if (data.part1.partnerBusiness) {
                    Object.keys(data.part1.partnerBusiness).forEach(key =>
                        setVal(`partner${key.charAt(0).toUpperCase() + key.slice(1)}`, data.part1.partnerBusiness[key]));
                }
                if (data.part1.officeUse) {
                    Object.keys(data.part1.officeUse).forEach(key =>
                        setVal(`officeUse${key.charAt(0).toUpperCase() + key.slice(1)}`, data.part1.officeUse[key]));
                    setRadio('officeUseStatus', data.part1.officeUse.status);
                }
                if (data.part1.guestCheckInSignature) {
                    setVal('guestCheckInSignatureName', data.part1.guestCheckInSignature.name);
                    setVal('guestCheckInSignatureIC', data.part1.guestCheckInSignature.ic);
                    setVal('guestCheckInSignatureDate', data.part1.guestCheckInSignature.date);
                }
            }
            if (data.part2) {
                if (data.part2.membershipApplicant) {
                    setRadio('applicantType', data.part2.membershipApplicant.applicantType);
                    setVal('applicantTitle', data.part2.membershipApplicant.title); setVal('applicantNameOnCard',
                        data.part2.membershipApplicant.nameOnCard);
                }
                if (data.part2.applicantOffice) {
                    setVal('applicantOfficeAddress', data.part2.applicantOffice.address);
                    setVal('applicantOfficePoskod', data.part2.applicantOffice.poskod); setVal('applicantOfficeCity',
                        data.part2.applicantOffice.city); setVal('applicantOfficeTel', data.part2.applicantOffice.tel);
                    setVal('applicantFax', data.part2.applicantOffice.fax);
                }
                if (data.part2.applicantBanking) {
                    setVal('applicantBankName', data.part2.applicantBanking.bankName);
                    setVal('applicantAccountNumber', data.part2.applicantBanking.accountNumber);
                }
                if (data.part2.sourceOfFunds) { setMultiCheck('sourceOfFunds', data.part2.sourceOfFunds); }
                if (data.part2.nominee) {
                    setCheck('nomineeIsPartner', data.part2.nominee.isPartner);
                    document.getElementById('nomineeIsPartner').dispatchEvent(new Event('change'));
                    Object.keys(data.part2.nominee).forEach(key => setVal(`nominee${key.charAt(0).toUpperCase() + key.slice(1)} `,
                        data.part2.nominee[key]));
                }
                if (data.part2.thirdPartyPayor) {
                    setCheck('payorIsApplicant', data.part2.thirdPartyPayor.isApplicant);
                    document.getElementById('payorIsApplicant').dispatchEvent(new Event('change'));
                    Object.keys(data.part2.thirdPartyPayor).forEach(key => setVal(`payor${key.charAt(0).toUpperCase() +
                        key.slice(1)
                        } `, data.part2.thirdPartyPayor[key]));
                }
                if (data.part2.salesDetail) {
                    setMultiCheck('productType', data.part2.salesDetail.productTypes); setRadio('transactionMethod',
                        data.part2.salesDetail.transactionMethod);
                    Object.keys(data.part2.salesDetail).forEach(key => setVal(key, data.part2.salesDetail[key]));
                    document.getElementById('subscriptionAmount').dispatchEvent(new Event('input')); // Recalculate total
                }
            }
            if (data.signatures) {
                Object.keys(data.signatures).forEach(key => {
                    const sig = data.signatures[key];
                    if (sig) {
                        setVal(`${key}SignatureName`, sig.name);
                        setVal(`${key}SignatureIC`, sig.ic);
                        setVal(`${key}SignatureDate`, sig.date);
                    }
                });
            }
        }

        function exportFullData() {
            if (!validateCurrentSection()) {
                alert("Please complete all required fields before exporting.");
                return;
            }
            const fullData = collectData();
            const guestName = fullData.part1.guestInfo.fullName.trim().replace(/\s+/g, '_') || 'Applicant';
            const fileName = `${guestName}_Full_Application.json`;
            const dataStr = JSON.stringify(fullData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert(`Full application data exported successfully as ${fileName}`);
        }

        function generateCombinedPdf() {
            if (!validateCurrentSection()) { return; }
            const formData = collectData();
            localStorage.setItem('tamuPrintData', JSON.stringify(formData));
            window.open('combined_forms.html', '_blank');
        }

        // Initialize datepicker for an input
        function initDatepicker(inputId, defaultToday = false) {
            $(`#${inputId}`).datepicker({
                dateFormat: 'dd/mm/yy',
                changeMonth: true,
                changeYear: true,
                yearRange: '-100:+0',
                maxDate: inputId === 'guestDob' ? '-18Y' : '+0D', // For DOB, limit to 18 years ago
                onSelect: function (dateText) {
                    // Store the formatted date for form submission
                    $(this).attr('data-date', moment(dateText, 'DD/MM/YYYY').format('YYYY-MM-DD'));
                }
            });

            if (defaultToday) {
                $(`#${inputId}`).datepicker('setDate', new Date());
            }

            // Remove the type="date" attribute to prevent browser's default datepicker
            $(`#${inputId}`).attr('type', 'text');
        }

        document.addEventListener('DOMContentLoaded', () => {
            showSection(1);

            // Initialize all date inputs with datepicker
            const dateInputs = [
                { id: 'guestDob', defaultToday: false },
                { id: 'partnerDob', defaultToday: false },
                { id: 'guestCheckInSignatureDate', defaultToday: true },
                { id: 'officeUseDate', defaultToday: true },
                { id: 'nomineeDob', defaultToday: false },
                { id: 'payorDob', defaultToday: false },
                { id: 'applicantSignatureDate', defaultToday: true },
                { id: 'nomineeSignatureDate', defaultToday: true },
                { id: 'thirdPartyPayorSignatureDate', defaultToday: true },
                { id: 'consultantSignatureDate', defaultToday: true },
                { id: 'witnessSignatureDate', defaultToday: true },
                { id: 'investmentManagerSignatureDate', defaultToday: true }
            ];

            dateInputs.forEach(input => {
                initDatepicker(input.id, input.defaultToday);
            });

            // Set up other event listeners
            document.getElementById('guestFullName').addEventListener('input', (e) => {
                document.getElementById('guestCheckInSignatureName').value = e.target.value;
            });

            document.getElementById('guestIcPassport').addEventListener('input', (e) => {
                document.getElementById('guestCheckInSignatureIC').value = e.target.value;
            });

            document.getElementById('mailingSameAsCorrespondent').addEventListener('change', function () {
                document.getElementById('mailingAddressFields').style.display = this.checked ? 'none' : 'grid';
            });

            const nomineeCheckbox = document.getElementById('nomineeIsPartner');
            const nomineeSection = document.getElementById('nomineeDetailsSection');
            const nomineeFields = nomineeSection.querySelectorAll('input, select, textarea');
            nomineeCheckbox.addEventListener('change', function () {
                const isHidden = this.checked;
                nomineeSection.style.display = isHidden ? 'none' : 'block';
                nomineeFields.forEach(el => { el.required = !isHidden; });
            });
            nomineeFields.forEach(el => { el.required = !nomineeCheckbox.checked; });

            const payorCheckbox = document.getElementById('payorIsApplicant');
            const payorSection = document.getElementById('thirdPartyPayorSection');
            const payorFields = payorSection.querySelectorAll('input, select, textarea');
            payorCheckbox.addEventListener('change', function () {
                const isHidden = this.checked;
                payorSection.style.display = isHidden ? 'none' : 'block';
                payorFields.forEach(el => { el.required = !isHidden; });
            });
            payorFields.forEach(el => { el.required = !payorCheckbox.checked; });

            const subAmount = document.getElementById('subscriptionAmount');
            const invAmount = document.getElementById('investmentAmount');
            const totalAmount = document.getElementById('totalAmount');
            const updateTotal = () => {
                totalAmount.value = (parseFloat(subAmount.value) || 0) +
                    (parseFloat(invAmount.value) || 0);
            };
            subAmount.addEventListener('input', updateTotal);
            invAmount.addEventListener('input', updateTotal);
        });
    </script>
</body>

</html>